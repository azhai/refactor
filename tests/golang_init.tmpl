package models

{{$initns := .Target.InitNameSpace -}}
import (
	"gitea.com/azhai/refactor/config"
	"gitea.com/azhai/refactor/config/dialect"
	{{- range $dir, $al := .Imports}}
	{{if ne $al $dir}}{{$al}} {{end -}}
	"{{$initns}}/{{$dir}}"{{end}}
)

var (
	configFile = "../settings.yml"
	settings   *config.Settings
	verbose    bool
)

func init() {
	settings, err := config.ReadSettings(configFile)
	if err != nil {
		panic(err)
	}
	verbose = settings.Application.Debug
	ConnectDatabases(settings.GetConnConfigMap())
}

func Verbose() bool {
	return verbose
}

func ConnectDatabases(confs map[string]config.ConnConfig) {
	for key, c := range confs {
		r, _ := config.NewReverseSource(c)
		switch key {
		{{- range $dir, $al := .Imports}}
			case "{{$dir}}":
			{{$al}}.Initialize(r, verbose){{end}}
		}
	}
}
